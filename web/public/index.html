<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Goal Reminder Bot</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="favicon.ico">
  <style>
    body.dark {
      background-color: #1a202c;
      color: #f7fafc;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen flex flex-col items-center p-4">
  <button id="darkToggle" class="fixed top-4 right-24 bg-black text-white px-3 py-1 rounded">🌙</button>
  <button id="musicToggle" class="fixed top-4 right-4 bg-blue-700 text-white px-3 py-1 rounded">🔊</button>

  <audio id="bg-music" src="/media/bg.mp3" loop></audio>
  <audio id="ding" src="/media/ding.mp3"></audio>

  <h1 class="text-3xl font-bold mb-4">🎯 Goal Reminder Bot</h1>

  <div id="quote" class="italic text-center text-sm text-gray-600 mb-4"></div>

  <form id="goalForm" class="flex flex-col gap-2 w-full max-w-md">
    <input class="p-2 rounded border" type="text" id="text" placeholder="Enter your goal..." required>
    <input class="p-2 rounded border" type="date" id="dueDate" placeholder="Due date">
    <select class="p-2 rounded border" id="category">
      <option value="🏃 Health">🏃 Health</option>
      <option value="💼 Work">💼 Work</option>
      <option value="👤 Personal">👤 Personal</option>
    </select>
    <input class="p-2 rounded border" type="text" id="customCategory" placeholder="Or enter new category...">
    <label class="inline-flex items-center">
      <input type="checkbox" id="recurring" class="mr-2"> Recurring
    </label>
    <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">➕ Add Goal</button>
  </form>

  <h2 class="text-xl font-semibold mt-8 mb-2">📋 Your Goals</h2>
  <select id="filterCategory" class="mb-2 p-2 border rounded">
    <option value="">All Categories</option>
    <option value="🏃 Health">🏃 Health</option>
    <option value="💼 Work">💼 Work</option>
    <option value="👤 Personal">👤 Personal</option>
  </select>

  <div id="progress" class="w-full max-w-md h-4 bg-gray-300 rounded overflow-hidden mb-2">
    <div id="progressBar" class="h-full bg-green-500" style="width: 0%"></div>
  </div>

  <div id="goals" class="grid gap-2 w-full max-w-md"></div>

  <h2 class="text-xl font-semibold mt-8 mb-2">📊 Your Success</h2>
  <canvas id="goalChart" class="my-6 w-full max-w-md"></canvas>

  <script>
    const ding = document.getElementById('ding');
    const music = document.getElementById('bg-music');
    let musicPlaying = false;

    document.getElementById('musicToggle').addEventListener('click', () => {
      if (musicPlaying) {
        music.pause();
        musicPlaying = false;
        document.getElementById('musicToggle').textContent = '🔇';
      } else {
        music.play();
        musicPlaying = true;
        document.getElementById('musicToggle').textContent = '🔊';
      }
    });

    document.getElementById('goalForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = document.getElementById('text').value;
      const dueDate = document.getElementById('dueDate').value;
      const custom = document.getElementById('customCategory').value.trim();
      const category = custom ? custom : document.getElementById('category').value;
      const recurring = document.getElementById('recurring').checked;
      const res = await fetch('/api/goals', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text, category, dueDate, recurring })
      });
      if (res.ok) {
        loadGoals();
        document.getElementById('goalForm').reset();
      }
    });

    async function loadGoals() {
      const res = await fetch('/api/goals');
      let goals = await res.json();
      const filter = document.getElementById('filterCategory').value;
      if (filter) goals = goals.filter(g => g.category === filter);

      const container = document.getElementById('goals');
      container.innerHTML = '';

      let completed = 0;
      let pending = 0;

      goals.forEach(goal => {
        const div = document.createElement('div');
        div.className = 'p-3 rounded shadow bg-white flex justify-between items-center';

        let countdown = '';
        if (goal.dueDate) {
          const now = new Date();
          const due = new Date(goal.dueDate);
          const daysLeft = Math.ceil((due - now) / (1000 * 60 * 60 * 24));
          countdown = `<br><small>⏳ ${daysLeft} day(s) left</small>`;
        }

        div.innerHTML = `<span>${goal.category} ${goal.text}${countdown}</span>
          <div>
            <button onclick="completeGoal('${goal.id}')" class="text-green-500">✔️</button>
            <button onclick="deleteGoal('${goal.id}')" class="text-red-500 ml-2">🗑️</button>
          </div>`;
        container.appendChild(div);

        goal.completed ? completed++ : pending++;
      });

      const total = completed + pending;
      const percent = total ? (completed / total * 100).toFixed(0) : 0;
      document.getElementById('progressBar').style.width = `${percent}%`;

      renderChart(pending, completed);
    }

    async function completeGoal(id) {
      await fetch(`/api/goals/${id}/complete`, { method: 'PATCH' });
      ding.play();
      loadGoals();
    }

    async function deleteGoal(id) {
      await fetch(`/api/goals/${id}`, { method: 'DELETE' });
      loadGoals();
    }

    function renderChart(pending, completed) {
      const ctx = document.getElementById('goalChart').getContext('2d');
      if (window.goalPieChart) window.goalPieChart.destroy();
      window.goalPieChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Pending', 'Completed'],
          datasets: [{
            data: [pending, completed],
            backgroundColor: ['#f59e0b', '#10b981']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' },
            title: {
              display: true,
              text: `Goal Summary: ${completed} Completed, ${pending} Pending`
            }
          }
        }
      });
    }

    async function loadQuote() {
      const quotes = [
  "Trust in the Lord with all your heart and lean not on your own understanding; in all your ways submit to him, and he will make your paths straight. – Proverbs 3:5-6",
  "‘For I know the plans I have for you,’ declares the Lord, ‘plans to prosper you and not to harm you, plans to give you hope and a future.’ – Jeremiah 29:11",
  "‘For my thoughts are not your thoughts, neither are your ways my ways,’ declares the Lord. – Isaiah 55:8-9",
  "Commit your way to the Lord; trust in him and he will do this. – Psalm 37:5",
  "Be still, and know that I am God. – Psalm 46:10",
  "But the plans of the Lord stand firm forever, the purposes of his heart through all generations. – Psalm 33:11",
  "You will keep in perfect peace those whose minds are steadfast, because they trust in you. – Isaiah 26:3-4",
  "Those who know your name trust in you, for you, Lord, have never forsaken those who seek you. – Psalm 9:10",
  "The Lord is my strength and my shield; my heart trusts in him, and he helps me. – Psalm 28:7",
  "Some trust in chariots and some in horses, but we trust in the name of the Lord our God. – Psalm 20:7",
  "Trust in him at all times, you people; pour out your hearts to him, for God is our refuge. – Psalm 62:8",
  "Commit to the Lord whatever you do, and he will establish your plans. – Proverbs 16:3",
  "In their hearts humans plan their course, but the Lord establishes their steps. – Proverbs 16:9",
  "So do not fear, for I am with you; do not be dismayed, for I am your God. – Isaiah 41:10",
  "I will say of the Lord, ‘He is my refuge and my fortress, my God, in whom I trust.’ – Psalm 91:2",
  "As for God, his way is perfect: The Lord’s word is flawless; he shields all who take refuge in him. – 2 Samuel 22:31",
  "The Lord is good to those whose hope is in him, to the one who seeks him. – Lamentations 3:25",
  "But as for me, I watch in hope for the Lord, I wait for God my Savior; my God will hear me. – Micah 7:7",
  "For the vision is yet for an appointed time... though it tarry, wait for it; because it will surely come. – Habakkuk 2:3",
  "Though he slay me, yet will I hope in him. – Job 13:15",
  "The Lord himself goes before you and will be with you; he will never leave you nor forsake you. – Deuteronomy 31:8",
  "You intended to harm me, but God intended it for good. – Genesis 50:20",
  "As for God, his way is perfect: The Lord’s word is flawless; he shields all who take refuge in him. – Psalm 18:30",
  "I will instruct you and teach you in the way you should go; I will counsel you with my loving eye on you. – Psalm 32:8",
  "The Lord will guide you always; he will satisfy your needs. – Isaiah 58:11",
  "And we know that in all things God works for the good of those who love him. – Romans 8:28",
  "But seek first his kingdom and his righteousness, and all these things will be given to you as well. – Matthew 6:33",
  "Do not be anxious about anything, but in every situation, by prayer and petition... the peace of God... will guard your hearts. – Philippians 4:6-7",
  "Being confident of this, that he who began a good work in you will carry it on to completion. – Philippians 1:6",
  "For we live by faith, not by sight. – 2 Corinthians 5:7",
  "Come to me, all you who are weary and burdened, and I will give you rest. – Matthew 11:28-29",
  "Do not let your hearts be troubled. You believe in God; believe also in me. – John 14:1",
  "Blessed is the one who perseveres under trial. – James 1:12",
  "...you do not even know what will happen tomorrow... Instead, you ought to say, ‘If it is the Lord’s will...’ – James 4:13-15",
  "Now faith is confidence in what we hope for and assurance about what we do not see. – Hebrews 11:1",
  "Cast all your anxiety on him because he cares for you. – 1 Peter 5:7",
  "May the God of hope fill you with all joy and peace as you trust in him. – Romans 15:13",
  "With man this is impossible, but with God all things are possible. – Matthew 19:26",
  "Whatever you ask for in prayer, believe that you have received it, and it will be yours. – Mark 11:24",
  "...Do not be afraid; you are worth more than many sparrows. – Luke 12:6-7",
  "God is faithful; he will not let you be tempted beyond what you can bear. – 1 Corinthians 10:13",
  "In him we were also chosen... according to the plan of him who works out everything. – Ephesians 1:11",
  "For God gave us a spirit not of fear but of power and love and self-control. – 2 Timothy 1:7",
  "Let the peace of Christ rule in your hearts. – Colossians 3:15",
  "Never will I leave you; never will I forsake you. – Hebrews 13:5",
  "Let us not become weary in doing good, for at the proper time we will reap a harvest. – Galatians 6:9",
  "...Then you will be able to test and approve what God’s will is—his good, pleasing and perfect will. – Romans 12:2",
  "In this world you will have trouble. But take heart! I have overcome the world. – John 16:33",
  "The one who calls you is faithful, and he will do it. – 1 Thessalonians 5:24",
  "So don’t be afraid; you are worth more than many sparrows. – Matthew 10:29-31"
];

      const quote = quotes[Math.floor(Math.random() * quotes.length)];
      document.getElementById('quote').textContent = `💡 "${quote}"`;
    }

    document.getElementById('darkToggle').addEventListener('click', () => {
      document.body.classList.toggle('dark');
    });

    document.getElementById('filterCategory').addEventListener('change', loadGoals);

    window.addEventListener('DOMContentLoaded', () => {
      loadQuote();
      loadGoals();
      setTimeout(() => {
        music.play().then(() => {
          musicPlaying = true;
        }).catch(() => {
          console.warn("🔇 Music autoplay blocked by browser");
        });
      }, 500);
    });
  </script>
</body>
</html>
